
<!DOCTYPE html>

<!-- Add or remove rows in the old banzuke table if necessary -->

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.5">
  <link rel="icon" type="image/x-icon" href="favicon.ico?v=2"/>
  <script type="text/javascript" src="redips-drag-min.js"></script>
  <script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>
  <link rel="stylesheet" href="styles.css" type="text/css"/>
  <script type="module" src="script.js"></script>
  <script async defer src="https://apis.google.com/js/api.js"></script>
  <script async defer src="https://accounts.google.com/gsi/client"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <title>GTB Helper</title>
</head>
<body>
  <header>
    <h1><span id="gtb">Guess the Banzuke </span>Helper Page</h1>
    <div id="links">
      <a href="http://sumodb.sumogames.de/gtb/GTBEntry.aspx" target="_blank">GTB Entry Form</a>
    </div>
    <span id="newFeature">NEW FEATURE!!! Export your draft directly to the entry form <button type="button" id="openModal">Here's how</button></span>
    <dialog id="insDialog">
      <button type="button" class="closeIns closeX">X</button>
      <div class="insSteps">
        1. Create a bookmarklet with the code below<br>
        <input id="bookmarkletCode" type="text" value="javascript:(function()%7Bif(%22http%3A%2F%2Fsumodb.sumogames.de%2Fgtb%2FGTBEntry.aspx%22!%3Dwindow.location.href)alert(%22Please%20make%20sure%20you're%20on%20the%20GTB%20entry%20form%20page%2C%20then%20try%20again.%22)%3Belse%20if(document.querySelector(%22%23helperFrame%22))document.querySelector(%22%23helperFrame%22).contentWindow.postMessage(%22Requesting%20data%22%2C%22*%22)%3Belse%7Bvar%20frame%3Ddocument.createElement(%22iframe%22)%2ChelperUrl%3D%22https%3A%2F%2Fgtbhelper.vercel.app%2F%22%2CloadingBox%3Ddocument.createElement(%22div%22)%3BloadingBox.innerText%3D%22Please%20wait...%22%2CloadingBox.id%3D%22pleaseWaitBox%22%2CloadingBox.style.cssText%3D%22border-radius%3A%2010px%3Bposition%3A%20fixed%3Btop%3A%2020px%3Bwidth%3A%20fit-content%3Bpadding%3A%2010px%2015px%3Bbackground%3A%20white%3Bleft%3A%2050%25%3Btransform%3A%20translateX(-50%25)%3Bborder%3A%201px%20outset%20gray%3Bbox-shadow%3A%205px%205px%203px%20%230006%3B%22%2Cdocument.body.appendChild(loadingBox)%2Cframe.setAttribute(%22src%22%2ChelperUrl)%2Cframe.style.display%3D%22none%22%2Cframe.id%3D%22helperFrame%22%2Cframe.addEventListener(%22load%22%2C(function()%7Bdocument.getElementById(%22pleaseWaitBox%22).remove()%2Cthis.contentWindow.postMessage(%22Requesting%20data%22%2C%22*%22)%7D))%2Cdocument.body.appendChild(frame)%2Cwindow.addEventListener(%22message%22%2C(function(e)%7Bif(e.origin%3D%3DhelperUrl%26%26%22rikishi%20ids%22%3D%3De.data.message)%7Bfor(var%20t%3De.data.ids%2Co%3Ddocument.getElementsByTagName(%22select%22)%2Ca%3D0%2Cn%3Ddocument.createElement(%22div%22)%2Cr%3D0%3Br%3C58%3Br%2B%2B)%7Bo%5Br%5D.value%3D-1%3Bfor(var%20d%3D0%3Bd%3Co%5Br%5D.options.length%3Bd%2B%2B)if(o%5Br%5D.options%5Bd%5D.value%3D%3Dt%5Br%5D)%7Bo%5Br%5D.value%3Dt%5Br%5D%2C-1!%3Dt%5Br%5D%26%26a%2B%2B%3Bbreak%7D%7D42!%3Da%26%26this.alert(%22Notice%3A%20Your%20entry%20has%20%22%2Ba%2B%22%20rikishi.%22)%2Cn.innerText%3D%22Done!%22%2Cn.id%3D%22doneBox%22%2Cn.style.cssText%3D%22border-radius%3A%2010px%3Bposition%3A%20fixed%3Btop%3A%2020px%3Bwidth%3A%20fit-content%3Bpadding%3A%2010px%2015px%3Bbackground%3A%20lightgreen%3Bleft%3A%2050%25%3Btransform%3A%20translateX(-50%25)%3Bborder%3A%201px%20outset%20gray%3Bbox-shadow%3A%205px%205px%203px%20%230006%3B%22%2Cdocument.body.appendChild(n)%2CsetTimeout((()%3D%3E%7Bthis.document.getElementById(%22doneBox%22).remove()%7D)%2C1e3)%7D%7D))%7D%7D)()%3B" disabled>
        <button type="button" id="copyCode">Copy</button>
        <ul>
          <li>To do this, first copy the line of code in the box</li>
          <li>Paste it to the URL section when creating a bookmark</li>
          <li>Alternatively, you can click-and-drag the code into the bookmarks toolbar</li>
          <li>Give it a name and then save it</li>
          <li>If you have trouble, you can just create any new bookmark and then change its name and URL</li>
        </ul>
      </div>
      <div class="insSteps">
        2. While on the GTB entry form page, click the bookmarklet you just created. This will "import" the current helper draft to the entry form. Keep in mind that if there are multiple rikishi stacked in a slot, only the topmost one will be selected.
      </div>
      <br>
      <button type="button" class="closeIns">Got it</button>
    </dialog>
    <ul>
      <li>Drag and drop rikishi from the old banzuke into the new banzuke</li>
      <li>Multiple rikishi can occupy a single slot in the new banzuke</li>
      <li>Click on individual rikishi's rank change to run a SumoDB query with the rikishi's current rank, number of wins and the new rank that will be highlighted</li>
      <li>Your every move is automatically saved to the browser's local storage so it will not reset when you refresh the page or close the browser</li>
      <li>You can copy & paste the banzuke into your preferred spreadsheet editor</li>
    </ul>
    <div id="options">
      <fieldset class="option">
        <legend>Double-click on rikishi</Legend>
          <label><input type="radio" class="checkbox" name="onDoubleClick" value="openRikishiPage">Open Rikishi Information page</label>
          <br>
          <label><input type="radio" class="checkbox" name="onDoubleClick" value="returnToOld">Return it to the old banzuke</label>
          <br>
          <label><input type="radio" class="checkbox" name="onDoubleClick" value="doNothing">Do nothing</label>
        </fieldset>
        <fieldset class="option">
          <legend>Dropping on an occupied slot</legend>
          <label title=""><input type="radio" class="checkbox" name="dropMode" value="multiple">Stack</label>
          <label title="Make room and lower rikishi below by one slot"><input type="radio" class="checkbox" name="dropMode" value="shift">Shift</label>
          <label title="Don't drop to occupied slot"><input type="radio" class="checkbox" name="dropMode" value="disable">Disable</label>
        </fieldset>
      <!--
      <fieldset id="hoshitori" class="option">
        <legend><label><input id="hoshiCheckbox" type="checkbox" name="checkbox" autocomplete="on">Hover over rikishi to highlight his opponents</label></legend>
        Explanation
        <div class="hoshitoriLegend" style="border: 2px solid black;">Win</div>
        <div class="hoshitoriLegend" style="border: 2px solid red;">Loss</div>
        <div class="hoshitoriLegend" style="border: 2px dashed black;">Win by fusen</div>
        <div class="hoshitoriLegend" style="border: 2px dashed red;">Loss by fusen</div>
        <div class="hoshitoriLegend" style="border: 2px outset #84848491; outline: 2px solid black; outline-offset: 2px;">Win in play-off</div>
        <div class="hoshitoriLegend" style="border: 2px outset #84848491; outline: 2px solid red; outline-offset: 2px;">Loss in play-off</div>
      </fieldset>
    -->
    <fieldset id="miscellany" class="option">
      <legend>Miscellany</legend>
      Export table data into CSV 
      <a href="#" id="exportToCsv1" class="exportToCsvButton">Table 1</a>
      <a href="#" id="exportToCsv2" class="exportToCsvButton">Table 2</a>
      <label><input id="tooltipCheckbox" type="checkbox" name="checkbox" autocomplete="on">Disable tooltips</label>
      <button id="autoArrange">Auto-arrange to current ranks</button>
      <button id="resetBanzuke">Reset changes</button>
    </fieldset>
    <fieldset id="saveLoad" class="option">
      <legend>Save/load drafts</legend>
      <button id="saveDraft">Save draft</button>
      <dialog id="saveDialog">
        <input type="text" name="" id="draftName" placeholder="name (optional)" autocomplete="off">
        <br>
        <button id="saveDraftButton">Save</button>
        <button id="closeDialog">Cancel</button>
      </dialog>
      <div id="draftsTableContainer">
        <table id="draftsTable">
          <tbody>
          </tbody>
        </table>
      </div>
    </fieldset>
    <label id="darkMode"> 
      Dark Mode <input type="checkbox" id="ChangeTheme"/>
    </label>
  </div>
    <!--
    <div id="saveLoadProgress">
      <button id="signinButton">Sign in with Google</button>
      <button id="signoutButton">Sign out</button>
      <button id="saveToDrive">Save banzuke</button>
      <button id="loadSave">Load last saved banzuke</button>
      <span id="messageLine"></span>
    </div>
  -->
</header>
<div id="redips-drag">
  <div id="tableContainer">
    <div id="shadowLeft"></div>
    <table id="tableLiner" class="mainTable">
      <span id="progressText"></span>
      <tr><td class="banzukeContainer">
        <div id="pop1" class="columnPopup">
          Columns... 
          <label><input id="colCheck1" autocomplete="off" class="columnCheckbox forB1 checkedByDefault" type="checkbox" value="rs1">Result</label>
          <label><input id="colCheck2" autocomplete="off" class="columnCheckbox forB1" type="checkbox" value="new">New Rank</label>
          <label><input id="colCheck3" autocomplete="off" class="columnCheckbox forB1" type="checkbox" value="ch1">Rank Change</label>
        </div>
        <table id="banzuke1" class="banzukeTable">
          <thead>
            <tr>
              <th colspan="5" class="tableTitle"></th>
            </tr>
            <tr class="theader">
              <th class="rs1">Result</th><th>East</th><th class="new hid">New<br>Rank</th><th class="ch1 hid">Rank<br>Chg.</th><th>Rank</th><th>West</th><th class="rs1">Result</th><th class="new hid">New<br>Rank</th><th class="ch1 hid">Rank<br>Chg.</th>
            </tr>
          </thead>
          <tbody id="banzuke1Body">
          </tbody>
        </table>
      </td><td class="banzukeContainer">
        <div class="columnPopup">
          <label><input id="colCheck4" autocomplete="off" class="columnCheckbox forB2 checkedByDefault" type="checkbox" value="rs2">Result</label>
          <label><input id="colCheck5" autocomplete="off" class="columnCheckbox forB2 checkedByDefault" type="checkbox" value="cur">Current Rank</label>
          <label><input id="colCheck6" autocomplete="off" class="columnCheckbox forB2 checkedByDefault" type="checkbox" value="ch2">Rank Change</label>
          <label><input id="colCheck7" autocomplete="off" class="columnCheckbox forB2" type="checkbox" value="nte">Notes</label>
        </div>
        <table id="banzuke2" class="mainTable banzukeTable">
          <thead>
            <tr>
              <th colspan="9" class="tableTitle"><span id="makRik">0</span>/42</th>
            </tr>
            <tr class="theader">
              <th class="nte hid">Notes</th><th class="cur">Curr.<br>Rank</th><th>East</th><th class="rs2">Result</th><th class="ch2">Rank<br>Chg.</th><th>Rank</th><th class="cur">Curr.<br>Rank</th><th>West</th><th class="rs2">Result</th><th class="ch2">Rank<br>Chg.</th><th class="nte hid">Notes</th>
            </tr>
          </thead>
          <tbody id="banzuke2Body">
          </tbody>
        </table>
      </td></tr>
    </table>
    <div id="shadowRight"></div>
  </div>
</div>
<footer>
  Created by Chiyotasuke
  <br>
  Based on Tsuchinoninjin's Helper Page
</footer>
</body>
</html>
